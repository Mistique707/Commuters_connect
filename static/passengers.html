<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carpool System - Passengers</title>
    <link rel="stylesheet" href="Home.css" />
    <link rel="stylesheet" href="FAQs.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  </head>
  <body>
    <main>
      <div class="titlebar">
        <div class="title-elements">
          <a href="Index.html">
            <div class="float-left">
              <img src="Connect.png" width="70%" />
            </div>
          </a>
        </div>
      </div>

      <div class="passengers-container">
        <div class="titles">Passengers & Publishers</div>
        <div class="passengers-list"></div>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let passengersContainer = document.querySelector(".passengers-list");
        // Retrieve passenger and ride data from localStorage
        let passengers = JSON.parse(localStorage.getItem("passengers")) || [];
        let rides = JSON.parse(localStorage.getItem("rides")) || [];

        if (passengers.length === 0) {
          passengersContainer.innerHTML = "<p>No passengers booked yet.</p>";
          return;
        }

        // Group passengers by the unique ride id stored in rideOwner
        let groupedPassengers = {};
        passengers.forEach(passenger => {
          let rideKey = passenger.rideOwner; // now this is the unique ride id
          if (!groupedPassengers[rideKey]) {
            groupedPassengers[rideKey] = [];
          }
          groupedPassengers[rideKey].push(passenger);
        });

        // For each group, find the corresponding ride and build a card
        Object.keys(groupedPassengers).forEach(rideKey => {
          // Find the ride using its unique id
          let rideInfo = rides.find(ride => ride.id == rideKey);
          if (rideInfo) {
            // Sum the total seats booked (if a passenger books multiple seats)
            let totalSeatsBooked = groupedPassengers[rideKey].reduce((sum, passenger) => {
              return sum + parseInt(passenger.seatsBooked, 10);
            }, 0);

            passengersContainer.innerHTML += `
              <div class="ride-group">
                <h3>Ride from ${rideInfo.leavingFrom} to ${rideInfo.goingTo} on ${rideInfo.dateTime}</h3>
                <p><strong>Published By:</strong> ${rideInfo.publisherName}</p>
                <p><strong>Publisher Contact:</strong> ${rideInfo.publisherContact}</p>
                <p><strong>Total Seats Booked:</strong> ${totalSeatsBooked}</p>
                <div class="passenger-items">
            `;

            groupedPassengers[rideKey].forEach(passenger => {
              passengersContainer.innerHTML += `
                <div class="passenger-item">
                  <p><strong>Name:</strong> ${passenger.name}</p>
                  <p><strong>Contact:</strong> ${passenger.contact}</p>
                  <p><strong>Gender:</strong> ${passenger.gender}</p>
                  <p><strong>Seats Booked:</strong> ${passenger.seatsBooked}</p>
                </div>
              `;
            });
            passengersContainer.innerHTML += `</div></div>`;
          }
        });
      });
    </script>
  </body>
</html>
